{% extends "chat/base.html" %}
{% block content %}
<div style="color: #152436; width: 100%; height: 500px; padding: 15px; overflow-y: scroll;">
    {# Load the previous messages of the selected room from the database #}
    {% for message in messages %}
        {% if message.sender_user == user %}
            <div style="float: right;">{{ message.sender_user }}: {{ message.message }}</div>
        {% else %}
            <div style="float: left;">{{ message.sender_user }}: {{ message.message }}</div>
        {% endif %}
    {% endfor %}
</div>
<div style="margin-left: 1%; padding-top: 1%;">
    <input id="chat-message-input" type="text" size="60" style="width: 80%;">
    &nbsp;
    <input id="chat-message-submit" type="button" value="Send" style="width: 13%; color: white; background-color: #182430;">
</div>
{% endblock %}


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.6/jquery.min.js"></script>
{{ room_name|json_script:"room-name" }}


<script>
      // Setting variables to display on the chat log
      var sender = '{{ sender_id }}';
      var receiver = '{{ receiver_id }}';
      var sender_name = '{{ sender_name }}';
      var user = '{{ user }}';
      const room_name = JSON.parse(document.getElementById('room-name').textContent);
  
      // Setting the WebSocket route as per the selected room name
      const chatSocket = new WebSocket(
          'ws://' + window.location.host + '/ws/chat/' + room_name + '/'
      );
  
      chatSocket.onmessage = function(e) {
          const data = JSON.parse(e.data);
          if (data.sender_name === user) {
              $("#chat-log").append("<div style='float: right'>" + data.sender_name + ": " + data.message + "</div><br>");
          } else {
              $("#chat-log").append("<div style='float: left'>" + data.sender_name + ": " + data.message + "</div><br>");
          }
          $("#chat-log").scrollTop($("#chat-log")[0].scrollHeight);
      };
  
      chatSocket.onclose = function(e) {
          console.error('Chat socket closed unexpectedly');
      };
  
  </script>